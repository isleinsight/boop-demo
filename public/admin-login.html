<script>
  document.addEventListener("DOMContentLoaded", () => {
    alert("If you see this, JavaScript is running!");

    const token = localStorage.getItem("jwtToken");

    if (!token) {
      window.location.href = "admin-login.html";
      return;
    }

    try {
      const payload = JSON.parse(atob(token.split('.')[1]));

      if (payload.role !== "admin") {
        alert("You do not have admin access.");
        window.location.href = "admin-login.html";
        return;
      }

      console.log("✅ Admin verified:", payload.email);
    } catch (err) {
      console.error("❌ Invalid or malformed token", err);
      localStorage.removeItem("jwtToken");
      window.location.href = "admin-login.html";
      return;
    }

    // Logout
    document.getElementById("logoutBtn")?.addEventListener("click", () => {
      localStorage.removeItem("jwtToken");
      window.location.href = "admin-login.html";
    });

    // Load users when page is ready
    loadUsers();
  });
</script>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>BOOP ‚Äî Parent Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="/assets/styles.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --ink:#0b1220; --ink2:#1a2b4a; --muted:#6b7280; --blue:#2f80ed; --bg:#f5f8fb; --stroke:#e6ebf1;
    }
    body{margin:0;background:var(--bg);font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#111827}
    /* NAV (white logo on dark bar) */
    nav{background:var(--ink);padding:10px 20px}
    .nav-container{display:flex;align-items:center;justify-content:space-between}
    .nav-left img{height:30px;display:block}

    .wrap{max-width:1100px;margin:32px auto;padding:0 16px}
    .grid{
      display:grid;grid-template-columns:1fr 1fr;gap:26px;
    }
    @media (max-width: 900px){
      .grid{grid-template-columns:1fr}
    }
    /* Card styles */
    .card{background:#fff;border:1px solid var(--stroke);border-radius:14px;box-shadow:0 10px 30px rgba(16,24,40,.08)}
    .card__body{padding:22px}
    .card h2{margin:0 0 8px;font-size:24px;color:var(--ink2)}
    .sub{margin:0 0 18px;color:var(--muted);font-size:.95rem}

    /* Login form */
    form{display:grid;gap:12px}
    label{font-size:.95rem;color:var(--ink2);font-weight:500}
    input[type="email"],input[type="password"]{
      width:100%;padding:12px 14px;border:1px solid var(--stroke);border-radius:8px;font-size:.95rem;outline:none
    }
    input:focus{border-color:var(--blue)}
    .btn{width:100%;padding:12px 14px;border:0;border-radius:10px;background:var(--blue);color:#fff;font-weight:600;cursor:pointer;font-size:1rem}
    .linkrow{display:flex;justify-content:space-between;gap:12px;font-size:.9rem}
    .linkrow a{color:var(--blue);text-decoration:none}
    .err{color:#ef4444;font-size:.92rem;min-height:1.2em}
    .hintok{color:#065f46;background:#f0fdf4;border:1px solid #bbf7d0;border-radius:10px;padding:10px;margin-top:6px;display:none}

    /* Info panel (cheerful) */
    .info-list{display:grid;gap:14px;margin-top:8px}
    .info-item{display:flex;gap:12px;align-items:flex-start}
    .icon{flex:0 0 36px;height:36px;border-radius:10px;display:grid;place-items:center;background:#eef2ff}
    .icon span{font-size:18px}
    .info-item h3{margin:0 0 4px;font-size:1.05rem;color:var(--ink2)}
    .info-item p{margin:0;color:var(--muted);font-size:.95rem}
    .cta{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap}
    .cta a.button{display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid var(--stroke);text-decoration:none}
  </style>
</head>
<body>
  <!-- Desktop-only guard (optional) -->
  <div id="screenGuard" style="display:none; position:fixed; inset:0; background:#0b1220; color:#fff; 
    display:flex; align-items:center; justify-content:center; text-align:center; padding:24px; z-index:9999;">
    <div style="max-width:540px;">
      <h2 style="margin:0 0 12px; font-family:Poppins, sans-serif;">Desktop Recommended</h2>
      <p>For the best experience, use a desktop or a tablet in landscape.</p>
    </div>
  </div>
  <script>
    (function(){
      const minWidth = 900;
      const guard = document.getElementById('screenGuard');
      function update(){ guard.style.display = (window.innerWidth < minWidth) ? 'flex' : 'none'; }
      window.addEventListener('resize', update, { passive:true });
      update();
    })();
  </script>

  <!-- NAV -->
  <nav>
    <div class="nav-container">
      <div class="nav-left">
        <a href="/"><img src="/assets/Boop-Logo.png" alt="BOOP Logo"></a>
      </div>
    </div>
  </nav>

  <div class="wrap">
    <div class="grid">
      <!-- LOGIN FIRST -->
      <div class="card">
        <div class="card__body">
          <h2>Parent Login</h2>
          <p class="sub">Sign in to view your child‚Äôs card activity, add funds, and manage safeguards.</p>

          <form id="loginForm" novalidate>
            <div>
              <label for="email">Email</label>
              <input type="email" id="email" placeholder="you@example.com" required />
            </div>
            <div>
              <label for="password">Password</label>
              <input type="password" id="password" placeholder="Your password" required />
            </div>
            <div class="linkrow">
              <a href="/password.html?mode=forgot">Forgot password?</a>
              <span></span>
            </div>
            <div id="loginErr" class="err"></div>
            <div id="loginOk" class="hintok">Signed in. Redirecting‚Ä¶</div>
            <button class="btn" type="submit">Sign In</button>
          </form>
        </div>
      </div>

      <!-- INFO SECOND -->
      <div class="card">
        <div class="card__body">
          <h2>About the Parent Portal</h2>
          <p class="sub">A simple, friendly place to support your child‚Äôs spending with visibility and controls.</p>

          <div class="info-list">
            <div class="info-item">
              <div class="icon"><span>üëÄ</span></div>
              <div>
                <h3>See spending in real time</h3>
                <p>Instant transaction history: where, when, and how much ‚Äî right at your fingertips.</p>
              </div>
            </div>

            <div class="info-item">
              <div class="icon"><span>üí∏</span></div>
              <div>
                <h3>Add funds in seconds</h3>
                <p>Top up your child‚Äôs card from your bank card. Transparent fees and fast availability.</p>
              </div>
            </div>

            <div class="info-item">
              <div class="icon"><span>üõ°Ô∏è</span></div>
              <div>
                <h3>Category safeguards</h3>
                <p>Choose where the card can be used (e.g., groceries yes, restricted categories no).</p>
              </div>
            </div>

            <div class="info-item">
              <div class="icon"><span>üîî</span></div>
              <div>
                <h3>Instant alerts <small style="color:#6b7280;">(coming soon)</small></h3>
                <p>Get notified on purchases or low balance, so there are no surprises.</p>
              </div>
            </div>
          </div>

          <div class="cta">
            <a class="button" href="/vendors.html">Find participating vendors</a>
            <a class="button" href="/contact.html">Become a vendor</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Parent-only login handler
    (function(){
      const form = document.getElementById('loginForm');
      const emailEl = document.getElementById('email');
      const pwEl = document.getElementById('password');
      const errEl = document.getElementById('loginErr');
      const okEl = document.getElementById('loginOk');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        errEl.textContent = '';
        okEl.style.display = 'none';

        const email = emailEl.value.trim();
        const password = pwEl.value;

        if (!email || !password) {
          errEl.textContent = 'Please enter your email and password.';
          return;
        }

        try {
          const res = await fetch('/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
          });
          const data = await res.json();

          if (!res.ok) {
            errEl.textContent = data.message || 'Login failed.';
            return;
          }

          const { token, user } = data;

          if ((user?.role || '').toLowerCase() !== 'parent') {
            errEl.textContent = 'This portal is for parents only. Please use the correct portal.';
            return;
          }

          // Save session
          localStorage.setItem('boop_jwt', token);
          localStorage.setItem('boopUser', JSON.stringify(user));

          // (optional) record session server-side, if your API supports it
          try {
            const payload = {
              email: user.email,
              user_id: user.id,
              jwt_token: token,
              status: 'online'
            };
            await fetch('/api/sessions', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
              body: JSON.stringify(payload)
            });
          } catch (e) { /* non-blocking */ }

          okEl.style.display = 'block';
          setTimeout(() => {
            window.location.href = '/parent/index.html';
          }, 500);

        } catch (err) {
          errEl.textContent = 'Network error. Please try again.';
        }
      });
    })();
  </script>
</body>
</html>

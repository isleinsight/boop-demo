<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Parent Portal — BOOP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Parents can track spending, add funds, and manage their child's BOOP Card." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --ink:#0b1220;        /* BOOP dark header */
      --boop:#2f80ed;       /* BOOP blue accent */
      --ink-2:#1a2b4a;      /* headings/body */
      --muted:#6b7280;
      --bg:#f5f8fb;
      --card:#ffffff;
      --stroke:#e6ebf1;
      --ok:#10b981;
      --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:#1f2937}

    /* ===== Top Nav (solid dark blue, white logo) ===== */
    .nav{
      background:var(--ink);
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .nav__inner{
      max-width:1120px;margin:0 auto;padding:12px 18px;
      display:flex;align-items:center;justify-content:flex-start;
    }
    .nav__logo{height:28px;display:block}

    /* ===== Page Layout (CSS Grid that stays perfectly aligned) ===== */
    .wrap{max-width:1120px;margin:0 auto;padding:28px 18px}
    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;   /* login a bit wider */
      grid-template-rows: 1fr 1fr;           /* two rows of equal height */
      gap:18px;
      align-items:stretch;
    }
    @media (max-width:900px){
      .grid{grid-template-columns:1fr;grid-template-rows:auto}
    }

    /* Left cell spans both rows so it equals the combined height of right cards */
    .loginCell{grid-column:1;grid-row:1 / span 2;display:flex}
    .rightCard1{grid-column:2;grid-row:1}
    .rightCard2{grid-column:2;grid-row:2}

    /* ===== Cards ===== */
    .card{
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:14px;
      box-shadow:0 10px 24px rgba(16,24,40,.06);
      padding:20px;
      display:flex;
      flex-direction:column;
    }

    /* Login card specifics */
    .loginCard{width:100%}
    .eyebrow{color:var(--boop);font-weight:600;letter-spacing:.02em;text-transform:uppercase;font-size:.9rem}
    .loginCard h1{font-size:clamp(24px,3.2vw,34px);margin:6px 0 8px;color:var(--ink-2)}
    .loginCard p{margin:0 0 14px;color:var(--muted)}
    form{display:grid;gap:12px}
    input{
      width:100%;padding:12px 14px;border:1px solid var(--stroke);border-radius:10px;
      font-size:.95rem;outline:none;transition:border-color .15s ease
    }
    input:focus{border-color:var(--boop)}
    button{
      width:100%;padding:12px 14px;border:0;border-radius:10px;background:var(--boop);
      color:#fff;font-weight:600;font-size:1rem;cursor:pointer;transition:transform .12s ease, opacity .12s ease
    }
    button:hover{transform:translateY(-1px)}
    button:disabled{opacity:.6;cursor:not-allowed}
    .helpRow{display:flex;justify-content:space-between;align-items:center;font-size:.9rem}
    .helpRow a{color:var(--boop);text-decoration:none}
    .msg{font-size:.92rem;margin-top:6px;display:none}
    .msg.error{color:var(--danger)}
    .msg.ok{color:var(--ok)}
    .footTip{font-size:.85rem;color:var(--muted);margin-top:6px}

    /* Info cards */
    .card h3{margin:0 0 8px;color:var(--ink-2)}
    .card p, .card ul{margin:0;color:#374151}
    ul.clean{list-style:none;padding:0;display:grid;gap:10px;margin-top:8px}
    ul.clean li{display:flex;gap:10px;align-items:flex-start}
    .dot{width:8px;height:8px;border-radius:999px;background:var(--boop);margin-top:8px;flex:0 0 8px}

    /* ===== Footer ===== */
    footer{margin-top:28px;border-top:1px solid var(--stroke);background:var(--bg)}
    .footer__inner{
      max-width:1120px;margin:0 auto;padding:18px;
      display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;color:#4b5563
    }
    .footer__links{display:flex;gap:16px}
    .footer__links a{color:#4b5563;text-decoration:none}
    .footer__links a:hover{text-decoration:underline}
  </style>
</head>
<body>
  <!-- Solid dark-blue header with your white logo -->
  <header class="nav">
    <div class="nav__inner">
      <a href="/"><img class="nav__logo" src="/assets/Boop-Logo.png" alt="BOOP" /></a>
    </div>
  </header>

  <main class="wrap">
    <section class="grid" aria-label="Parent Portal">
      <!-- LEFT: Login (spans both right rows for perfect alignment) -->
      <div class="loginCell">
        <div class="card loginCard">
          <div class="eyebrow">Parent Portal</div>
          <h1>Log in to manage your child’s BOOP Card</h1>
          <p>Track spending, add funds, and keep them on budget.</p>

          <form id="parentLoginForm" novalidate>
            <input type="email" id="email" placeholder="Email" autocomplete="email" required />
            <input type="password" id="password" placeholder="Password" autocomplete="current-password" required />
            <button type="submit" id="loginBtn">Sign in</button>

            <div class="helpRow">
              <a href="/password.html?mode=forgot">Forgot password?</a>
              <a href="/contact.html">Need help?</a>
            </div>

            <div id="loginMsg" class="msg" aria-live="polite"></div>
            <div class="footTip">By signing in you agree to BOOP’s Terms and Privacy Policy.</div>
          </form>
        </div>
      </div>

      <!-- RIGHT: Card 1 -->
      <article class="card rightCard1" aria-label="Helpful Controls">
        <h3>Helpful Controls</h3>
        <p>Keep them on track with simple guardrails.</p>
        <ul class="clean">
          <li><span class="dot"></span><span>Set monthly spending caps (program-dependent).</span></li>
          <li><span class="dot"></span><span>Category safeguards so funds go to essentials.</span></li>
          <li><span class="dot"></span><span>Freeze/unfreeze the card if it’s misplaced.</span></li>
        </ul>
      </article>

      <!-- RIGHT: Card 2 -->
      <article class="card rightCard2" aria-label="Peace of Mind">
        <h3>Peace of Mind</h3>
        <p>Clarity without micromanaging.</p>
        <ul class="clean">
          <li><span class="dot"></span><span>See balance and recent purchases at a glance.</span></li>
          <li><span class="dot"></span><span>Get alerted to large or unusual transactions (coming soon).</span></li>
          <li><span class="dot"></span><span>Export clean statements anytime.</span></li>
        </ul>
      </article>
    </section>
  </main>

  <footer>
    <div class="footer__inner">
      <span>© BOOP 2025</span>
      <nav class="footer__links" aria-label="Legal">
        <a href="/terms.html">Terms</a>
        <a href="/privacy.html">Privacy</a>
      </nav>
    </div>
  </footer>

  <script>
    (function(){
      const REDIRECT_AFTER_LOGIN = "/parent/index.html";

      const form = document.getElementById("parentLoginForm");
      const emailEl = document.getElementById("email");
      const pwEl = document.getElementById("password");
      const btn = document.getElementById("loginBtn");
      const msg = document.getElementById("loginMsg");

      function showMsg(text, type="error"){
        msg.textContent = text;
        msg.className = "msg " + (type === "ok" ? "ok" : "error");
        msg.style.display = "block";
      }

      form.addEventListener("submit", async (e)=>{
        e.preventDefault();
        msg.style.display = "none";
        btn.disabled = true;

        const email = emailEl.value.trim();
        const password = pwEl.value;

        if(!email || !password){
          showMsg("Please enter your email and password.");
          btn.disabled = false;
          return;
        }

        try{
          const res = await fetch("/auth/login", {
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body: JSON.stringify({ email, password })
          });

          const data = await res.json().catch(()=> ({}));

          if(!res.ok){
            showMsg(data.message || "Login failed. Please check your credentials.");
            btn.disabled = false;
            return;
          }

          const { token, user } = data;

          if((user?.role || "").toLowerCase() !== "parent"){
            showMsg("This portal is for parents only. Please use the correct account.");
            btn.disabled = false;
            return;
          }

          localStorage.setItem("boop_jwt", token);
          localStorage.setItem("boopUser", JSON.stringify(user));

          // Optional session record
          try{
            const payload = JSON.parse(atob(token.split(".")[1] || ""));
            const expiresAt = payload?.exp ? new Date(payload.exp * 1000).toISOString() : null;

            await fetch("/api/sessions", {
              method:"POST",
              headers:{
                "Content-Type":"application/json",
                "Authorization": `Bearer ${token}`
              },
              body: JSON.stringify({
                email: user.email,
                user_id: user.id,
                jwt_token: token,
                expires_at: expiresAt,
                status: "online"
              })
            }).catch(()=>{});
          } catch(_) {}

          showMsg("Success! Redirecting…","ok");
          window.location.href = REDIRECT_AFTER_LOGIN;

        }catch(err){
          showMsg("Network error. Please try again.");
          btn.disabled = false;
        }
      });
    })();
  </script>
</body>
</html>

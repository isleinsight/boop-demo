<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Add User - BOOP Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../assets/styles.css" />
  <style>
    :root { 
      --muted: #6b7280; 
      --stroke: #d1d9e6; 
    }

    h3 {
      font-size: 1.6rem;
      color: #1a2b4a;
      margin-bottom: 16px;
    }

    p {
      font-size: 0.9rem;
      color: #4b5563;
      margin: 0 0 20px;
      line-height: 1.5;
    }

    p strong {
      color: #1a2b4a;
    }

    label {
      display: block;
      font-size: 0.95rem;
      color: #1a2b4a;
      margin-bottom: 8px;
      font-weight: 500;
    }

    input, select {
      padding: 12px 16px;
      margin-top: 4px;
      width: 100%;
      box-sizing: border-box;
      border: 1px solid var(--stroke);
      border-radius: 6px;
      font-size: 0.95rem;
      transition: border-color 0.2s ease;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #2f80ed;
    }

    select {
      appearance: none;
      background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMi4wMDAwNiA1LjY2NjdMOC4wMDAwNiAxMS42NjY3TDE0LjAwMDEgNS42NjY3IiBzdHJva2U9IiM2Yjc1N2QiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+') no-repeat right 12px center;
      background-size: 16px;
    }

    button {
      padding: 12px 16px;
      margin-top: 20px;
      width: 100%;
      background: #2f80ed;
      color: #fff;
      font-weight: 500;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.95rem;
      transition: background-color 0.2s ease;
    }

    button:hover {
      background: #1c6fd8;
    }

    /* Checkbox Styling */
    #assistanceContainer label {
      display: flex;
      align-items: center;
      font-size: 0.95rem;
      color: #1a2b4a;
      margin-top: 12px;
      cursor: pointer;
    }

    #onAssistance {
      width: auto;
      margin-right: 8px;
      accent-color: #2f80ed;
      transform: scale(1.2);
    }

    /* Navigation */
    .nav-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
      padding: 10px 20px;
    }

    .hamburger {
      display: none;
      flex-direction: column;
      justify-content: space-between;
      width: 24px;
      height: 20px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      z-index: 1100;
    }

    .hamburger span {
      width: 100%;
      height: 3px;
      background: #ffffff; /* White for dark navbar background */
      transition: all 0.3s ease;
    }

    .hamburger.active span {
      background: #1a2b4a; /* Dark color for X when menu is open */
    }

    .hamburger.active span:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
    }

    .hamburger.active span:nth-child(2) {
      opacity: 0;
    }

    .hamburger.active span:nth-child(3) {
      transform: rotate(-45deg) translate(7px, -7px);
    }

    .nav-dropdown {
      position: relative;
      display: inline-block;
    }

    .dropbtn {
      padding: 10px 16px;
      text-decoration: none;
      color: #ffffff; /* White for dark navbar background */
      transition: background-color 0.2s ease;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      background: #fff;
      min-width: 160px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 1;
    }

    .dropdown-content a {
      color: #333;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      font-size: 0.95rem;
      transition: background-color 0.2s ease;
    }

    .dropdown-content a:hover {
      color: #2f80ed;
    }

    .nav-dropdown:hover .dropdown-content {
      display: block;
    }

    @media (max-width: 768px) {
      .hamburger {
        display: flex;
        position: absolute;
        top: 50%;
        right: 20px;
        transform: translateY(-50%);
      }

      .nav-right {
        position: fixed;
        top: 0;
        right: -100%;
        width: 250px;
        height: 100%;
        background: #fff;
        flex-direction: column;
        align-items: flex-start;
        padding: 80px 20px;
        transition: right 0.3s ease;
        box-shadow: -4px 0 12px rgba(0, 0, 0, 0.15);
        z-index: 1000;
      }

      .nav-right.active {
        right: 0;
      }

      .nav-right a {
        color: #333;
        font-size: 1rem;
        padding: 12px 0;
        width: 100%;
        text-align: left;
        text-decoration: none;
      }

      .dropdown-content {
        display: none;
        position: static;
        background: none;
        box-shadow: none;
        width: 100%;
        transition: opacity 0.3s ease;
        opacity: 0;
      }

      .nav-right.active .dropdown-content.active {
        display: block;
        opacity: 1;
      }

      .nav-dropdown a {
        color: #333;
      }

      .nav-dropdown:hover .dropdown-content {
        display: none; /* Prevent hover on mobile */
      }
    }

    /* Status Message */
    .status-message {
      margin-top: 16px;
      padding: 12px 16px;
      border-radius: 6px;
      font-size: 0.95rem;
      text-align: center;
      display: none;
    }

    .status-message.success {
      background: #f0fdf4;
      color: #2ecc71;
      border: 1px solid #bbf7d0;
      display: block;
    }

    .status-message.error {
      background: #fef3f2;
      color: #e63946;
      border: 1px solid #f8c4c1;
      display: block;
    }
  </style>
</head>
<body>
  <!-- Top Nav -->
  <nav>
    <div class="nav-container">
      <div class="nav-left">
        <img src="../assets/Boop-Logo.png" alt="BOOP Logo" />
      </div>
      <button class="hamburger" aria-label="Toggle navigation">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <div class="nav-right">
        <a href="index.html">Dashboard</a>
        <a href="admin-actions.html">Admin Actions</a>
        <div class="nav-dropdown">
          <a href="#" class="dropbtn">Add</a>
          <div class="dropdown-content">
            <a href="add-user.html" id="addUserLink">Add User</a>
            <a href="assign-card.html" id="assignCardLink">Assign Card</a>
            <a href="assign-student.html">Assign Student</a>
          </div>
        </div>
        <a href="view-users.html">View Users</a>
        <a href="#" id="logoutBtn">Log Out</a>
      </div>
    </div>
  </nav>

  <div class="container-small">
    <form id="addUserForm">
      <h3>Create New User</h3>

      <p>
        Use this form to create a new user. Select a role to reveal additional options.<br />
        <strong>Note:</strong> The "On Assistance" toggle only applies to <strong>Cardholder</strong> users.
      </p>

      <label for="email">Email</label>
      <input type="email" id="email" required />

      <label for="password">Password</label>
      <input type="password" id="password" required />

      <label for="firstName">First Name</label>
      <input type="text" id="firstName" required />

      <label for="middleName">Middle Name</label>
      <input type="text" id="middleName" />

      <label for="lastName">Last Name</label>
      <input type="text" id="lastName" required />

      <label for="role">Role</label>
      <select id="role" required>
        <option value="">Select Role</option>
        <option value="admin">Admin</option>
        <option value="student">Student</option>
        <option value="parent">Parent</option>
        <option value="senior">Senior</option>
        <option value="vendor">Vendor</option>
        <option value="cardholder">Cardholder</option>
      </select>

      <div id="adminTypeContainer" style="display: none;">
        <label for="adminType">Admin Type</label>
        <select id="adminType">
          <option value="">Select Admin Type</option>
          <option value="super_admin">Super Admin</option>
          <option value="admin">Admin</option>
          <option value="support">Support</option>
          <option value="accountant">Accountant</option>
          <option value="viewer">Viewer</option>
        </select>
      </div>

      <div id="assistanceContainer" style="display: none;">
        <label>
          On Assistance
          <input type="checkbox" id="onAssistance" />
        </label>
      </div>

      <div id="vendorFields" style="display:none;">
        <label for="businessName">Business Name</label>
        <input type="text" id="businessName" />

        <label for="vendorPhone">Phone</label>
        <input type="tel" id="vendorPhone" />

        <label for="vendorCategory">Category</label>
        <input type="text" id="vendorCategory" />
      </div>

      <div id="studentFields" style="display:none;">
        <label for="studentSchoolName">School Name</label>
        <input type="text" id="studentSchoolName" placeholder="School student attends" required />

        <label for="studentGradeLevel">Grade Level</label>
        <input type="text" id="studentGradeLevel" placeholder="e.g. Primary 6" />

        <label for="expiryDate">Expiry Date</label>
        <input type="date" id="expiryDate" />
      </div>

      <button type="submit">Create User</button>
      <div id="formStatus" class="status-message"></div>
    </form>
  </div>

  <script>
    const user = JSON.parse(localStorage.getItem("boopUser"));
    const allowedTypes = ["super_admin", "admin"];

    const isAuthorized =
      user &&
      typeof user === "object" &&
      user.role === "admin" &&
      allowedTypes.includes(user.type);

    if (!isAuthorized) {
      window.location.href = "login.html";
    }

    document.addEventListener("DOMContentLoaded", () => {
      console.log("admin.js has loaded!");

      // Hide "Add User" and "Assign Card" links for viewer or support users
      if (user?.type === "viewer" || user?.type === "support") {
        const addUserLink = document.getElementById("addUserLink");
        const assignCardLink = document.getElementById("assignCardLink");
        if (addUserLink) addUserLink.style.display = "none";
        if (assignCardLink) assignCardLink.style.display = "none";
      }

      const logoutBtn = document.getElementById("logoutBtn");
      if (logoutBtn) {
        logoutBtn.addEventListener("click", (e) => {
          e.preventDefault();
          localStorage.removeItem("boopUser");
          window.location.href = "login.html";
        });
      }
    });
  </script>
  <script type="module" src="add-user.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const hamburger = document.querySelector(".hamburger");
      const navRight = document.querySelector(".nav-right");
      const dropbtn = document.querySelector(".nav-dropdown .dropbtn");
      const dropdownContent = document.querySelector(".dropdown-content");

      hamburger?.addEventListener("click", () => {
        const active = hamburger.classList.toggle("active");
        navRight.classList.toggle("active", active);
        hamburger.setAttribute("aria-expanded", active ? "true" : "false");
      });

      dropbtn?.addEventListener("click", (e) => {
        if (window.innerWidth <= 768) {
          e.preventDefault();
          dropdownContent?.classList.toggle("active");
        }
      });

      navRight?.querySelectorAll("a").forEach(a => {
        a.addEventListener("click", () => {
          hamburger?.classList.remove("active");
          navRight.classList.remove("active");
          dropdownContent?.classList.remove("active");
        });
      });
    });
  </script>
</body>
</html>

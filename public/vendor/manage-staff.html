<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Manage Staff – Vendor | Payulot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --ink:#102a43; --muted:#6b7c93; --blue:#2f80ed; --blue-dark:#1a5fcc;
      --bg:#ffffff; --panel:#ffffff; --stroke:#e5e7eb; --soft:#f8fafc;
      --ok:#16a34a; --warn:#f59e0b; --bad:#ef4444; --nav:#0b1220;
    }
    *{box-sizing:border-box}
    body{ margin:0; font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); color:var(--ink); }

    /* NAV (same as vendor) */
    .vendor-nav{ background:var(--nav); color:#fff; position:sticky; top:0; z-index:50; }
    .vendor-nav .nav-container{
      max-width:1100px; margin:0 auto;
      padding:10px 18px;
      display:flex; align-items:center; justify-content:space-between;
    }
    .vendor-nav .nav-left img{ height:30px; display:block; }
    .vendor-nav .nav-right{ display:flex; align-items:center; gap:16px; }
    .vendor-nav .nav-right a{
      color:#fff; text-decoration:none; font-size:.95rem; line-height:1; padding:6px 8px; border-radius:6px; opacity:.95;
    }
    .vendor-nav .nav-right a[aria-current="page"]{ opacity:1; background:rgba(255,255,255,.08); }
    .vendor-nav .nav-right a:hover{ opacity:1; background:rgba(255,255,255,.08); }

    /* Header */
    .header{ max-width:1100px; margin:18px auto 0; padding:0 20px; }
    .header h1{ margin:16px 0 6px; font-size:clamp(22px,3vw,28px); }
    .sub{ color:var(--muted); margin:0; }

    /* Container */
    .container{ max-width:1100px; margin:16px auto 40px; padding:0 20px; }
    .card{
      background:var(--panel); border:1px solid var(--stroke); border-radius:14px; padding:18px;
      box-shadow:0 8px 24px rgba(0,0,0,.06); margin-bottom:16px;
    }
    h2{ margin:0 0 12px; font-size:1.12rem; }

    .btn{ display:inline-flex; align-items:center; justify-content:center; gap:6px;
      padding:8px 14px; border-radius:10px; font-weight:600; cursor:pointer; border:1px solid transparent; }
    .btn.primary{ background:var(--blue); color:#fff; border-color:var(--blue); }
    .btn.primary:hover{ background:var(--blue-dark); }
    .btn.ghost{ background:#fff; border:1px solid var(--stroke); color:#111827; }
    .btn.ghost:hover{ border-color:#cbd5e1; }
    .btn.danger{ background:var(--bad); color:#fff; border-color:var(--bad); }
    .btn.small{ padding:6px 10px; font-size:.85rem; }

    table{ width:100%; border-collapse:collapse; }
    th, td{ text-align:left; padding:10px; border-bottom:1px solid var(--stroke); }
    th{ background:#f9fafb; font-size:.9rem; color:#374151; }
    td.actions{ white-space:nowrap; }

    .alert{ padding:10px 12px; border-radius:10px; border:1px solid var(--stroke); margin-bottom:12px; }
    .alert.ok{ border-color:#dcfce7; background:#f0fdf4; color:#166534; }
    .alert.bad{ border-color:#fee2e2; background:#fef2f2; color:#991b1b; }

    /* Modal */
    .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center;
      background:rgba(0,0,0,.45); z-index:1000; }
    .modal-content{ background:#fff; border:1px solid var(--stroke); border-radius:12px; padding:18px; max-width:420px; width:92%; }
    .modal-content label{ display:block; margin:10px 0 4px; font-size:.9rem; color:var(--muted); }
    .modal-content input{ width:100%; padding:10px; border:1px solid var(--stroke); border-radius:8px; }
  </style>
</head>
<body>
  <!-- NAV -->
  <nav class="vendor-nav">
    <div class="nav-container">
      <div class="nav-left">
        <a href="index.html"><img src="../assets/logo-white.png" alt="Payulot"></a>
      </div>
      <div class="nav-right">
        <a href="index.html">Home</a>
        <a href="transfer.html">Transfer</a>
        <a href="transactions.html">Transactions</a>
        <a href="managestaff.html" aria-current="page">Manage Staff</a>
        <a href="#" id="logoutBtn">Log Out</a>
      </div>
    </div>
  </nav>

  <!-- Header -->
  <header class="header">
    <h1>Manage Staff</h1>
    <p class="sub">Add, edit, or remove staff accounts for your business.</p>
  </header>

  <!-- Content -->
  <main class="container">
    <div id="flash" class="alert" style="display:none;"></div>

    <section class="card">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2>Staff Members</h2>
        <button id="addStaffBtn" class="btn primary">+ Add Staff</button>
      </div>
      <table>
        <thead>
          <tr><th>Name</th><th>Email</th><th>Role</th><th class="actions">Actions</th></tr>
        </thead>
        <tbody id="staffTable"><tr><td colspan="4">Loading…</td></tr></tbody>
      </table>
    </section>
  </main>

  <!-- Add/Edit Modal -->
  <div id="staffModal" class="modal">
    <div class="modal-content">
      <h3 id="modalTitle">Add Staff</h3>
      <label>Name</label>
      <input id="staffName" type="text" />
      <label>Email</label>
      <input id="staffEmail" type="email" />
      <label>Password</label>
      <input id="staffPassword" type="password" placeholder="Set password" />
      <div id="staffMsg" class="alert bad" style="display:none;"></div>
      <div style="margin-top:12px; display:flex; gap:10px; justify-content:flex-end;">
        <button id="saveStaffBtn" class="btn primary">Save</button>
        <button id="cancelStaffBtn" class="btn ghost">Cancel</button>
      </div>
    </div>
  </div>

  <footer>
    <div class="footer-inner" style="max-width:1100px;margin:0 auto;padding:16px 18px;display:flex;justify-content:space-between;color:#6b7280;font-size:.9rem;">
      <div>© 2025 Payulot</div>
      <div class="footer-links">
        <a href="../terms.html">Terms</a>
        <a href="../privacy.html">Privacy</a>
      </div>
    </div>
  </footer>

  <script>
    const token = localStorage.getItem("boop_jwt");
    const staffTable = document.getElementById("staffTable");
    const flash = document.getElementById("flash");

    const staffModal = document.getElementById("staffModal");
    const modalTitle = document.getElementById("modalTitle");
    const staffName = document.getElementById("staffName");
    const staffEmail = document.getElementById("staffEmail");
    const staffPassword = document.getElementById("staffPassword");
    const staffMsg = document.getElementById("staffMsg");
    const saveStaffBtn = document.getElementById("saveStaffBtn");
    const cancelStaffBtn = document.getElementById("cancelStaffBtn");

    let editingId = null;

    function showFlash(msg, ok=true){
      flash.textContent = msg;
      flash.className = "alert " + (ok ? "ok" : "bad");
      flash.style.display = "block";
      setTimeout(()=> flash.style.display="none", 4000);
    }

    async function loadStaff(){
      staffTable.innerHTML = "<tr><td colspan='4'>Loading…</td></tr>";
      try{
        const res = await fetch("/api/vendor-staff", { headers:{ Authorization:`Bearer ${token}` }});
        const data = await res.json();
        if(!res.ok) throw new Error(data.message || "Failed to load staff");
        if(!Array.isArray(data) || !data.length){
          staffTable.innerHTML = "<tr><td colspan='4'>No staff yet.</td></tr>";
          return;
        }
        staffTable.innerHTML = data.map(s=>`
          <tr>
            <td>${s.name||""}</td>
            <td>${s.email||""}</td>
            <td>${s.role||"cashier"}</td>
            <td class="actions">
              <button class="btn small ghost" onclick="editStaff('${s.id}','${s.name}','${s.email}')">Edit</button>
              <button class="btn small danger" onclick="deleteStaff('${s.id}')">Delete</button>
            </td>
          </tr>`).join("");
      }catch(e){
        staffTable.innerHTML = `<tr><td colspan="4">${e.message}</td></tr>`;
      }
    }

    // Add / Edit
    document.getElementById("addStaffBtn").addEventListener("click", ()=>{
      editingId = null;
      modalTitle.textContent = "Add Staff";
      staffName.value=""; staffEmail.value=""; staffPassword.value="";
      staffModal.style.display="flex"; staffMsg.style.display="none";
    });
    cancelStaffBtn.addEventListener("click", ()=> staffModal.style.display="none");

    saveStaffBtn.addEventListener("click", async ()=>{
      const body = { name:staffName.value.trim(), email:staffEmail.value.trim(), password:staffPassword.value.trim() };
      try{
        let res;
        if(editingId){
          res = await fetch("/api/vendor-staff/"+editingId, { method:"PATCH", headers:{ "Content-Type":"application/json", Authorization:`Bearer ${token}` }, body:JSON.stringify(body) });
        }else{
          res = await fetch("/api/vendor-staff", { method:"POST", headers:{ "Content-Type":"application/json", Authorization:`Bearer ${token}` }, body:JSON.stringify(body) });
        }
        const data = await res.json();
        if(!res.ok) throw new Error(data.message||"Save failed");
        staffModal.style.display="none"; showFlash("Saved.", true); loadStaff();
      }catch(e){ staffMsg.textContent=e.message; staffMsg.style.display="block"; }
    });

    // Edit / Delete helpers
    window.editStaff = (id,name,email)=>{
      editingId = id;
      modalTitle.textContent="Edit Staff";
      staffName.value=name; staffEmail.value=email; staffPassword.value="";
      staffModal.style.display="flex"; staffMsg.style.display="none";
    };
    window.deleteStaff = async (id)=>{
      if(!confirm("Delete this staff?")) return;
      try{
        const res = await fetch("/api/vendor-staff/"+id, { method:"DELETE", headers:{ Authorization:`Bearer ${token}` }});
        const data = await res.json();
        if(!res.ok) throw new Error(data.message||"Delete failed");
        showFlash("Deleted.", true); loadStaff();
      }catch(e){ showFlash(e.message,false); }
    };

    // Logout
    document.getElementById("logoutBtn").addEventListener("click", async (e)=>{
      e.preventDefault(); try{ await fetch("/api/logout",{method:"POST"});}catch{} localStorage.clear(); location.href="vendor-login.html";
    });

    loadStaff();
  </script>
</body>
</html>

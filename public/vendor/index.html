<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Vendor Dashboard – BOOP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../assets/styles.css" />
  <style>
    :root { --ink:#1a2b4a; --muted:#6b7280; --stroke:#e6ebf1; }

    body { font-family:'Poppins',sans-serif; background:#f5f7fa; margin:0; color:var(--ink); }

    /* ──────────────────────────────────────────────
       LOCKED VENDOR NAV — matches Transfer/Transactions
       Add class="vendor-nav" to the <nav> on ALL vendor pages
    ────────────────────────────────────────────── */
    .vendor-nav { background:#0b1220; color:#fff; position:sticky; top:0; z-index:50; }
    .vendor-nav .nav-container{
      max-width:1100px; margin:0 auto;
      padding:10px 18px !important;                /* lock bar height */
      display:flex; align-items:center; justify-content:space-between;
    }
    .vendor-nav .nav-left img{
      height:30px !important; display:block;       /* lock logo size */
    }
    .vendor-nav .nav-right{
      display:flex; align-items:center;
      gap:16px !important;                         /* lock spacing between links */
    }
    .vendor-nav .nav-right a{
      color:#fff; text-decoration:none;
      font-size:.95rem !important;
      line-height:1 !important;
      padding:6px 8px !important;                  /* lock link padding */
      border-radius:6px; opacity:.95;
    }
    .vendor-nav .nav-right a:hover{
      opacity:1; text-decoration:none; background:rgba(255,255,255,.08);
    }

    /* Hero + content (unchanged) */
    .hero { background:linear-gradient(180deg,#f7fafc,#fff); border-bottom:1px solid var(--stroke); }
    .hero-inner { max-width:1100px; margin:0 auto; padding:24px 18px; }
    .hero h1 { margin:0 0 6px; font-size:1.75rem; font-weight:600; }
    .hero-sub { margin:0; color:#4b5563; }

    .stats { max-width:1100px; margin:18px auto 0; padding:0 18px 8px; display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px; }
    .stat { background:#fff; border:1px solid var(--stroke); border-radius:12px; padding:14px; }
    .stat .label { color:var(--muted); font-size:0.9rem; margin:0 0 6px; }
    .stat .value { font-size:1.25rem; font-weight:600; }

    .tiles { max-width:1100px; margin:10px auto 40px; padding:0 18px; display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:14px; }
    .tile { display:flex; gap:12px; align-items:center; padding:14px; border:1px solid var(--stroke); background:#fff; border-radius:12px; text-decoration:none; color:var(--ink); box-shadow:0 6px 16px rgba(0,0,0,.06); transition:transform .15s ease, border-color .15s ease; }
    .tile:hover { border-color:#d7deea; transform:translateY(-1px); }
    .tile .icon { width:28px; height:28px; flex:0 0 28px; }
    .tile .title { font-weight:600; font-size:0.98rem; }
    .tile .sub { color:#6b7280; font-size:.9rem; }

    /* Footer (same style as other vendor pages) */
    footer { border-top:1px solid var(--stroke); background:#fff; }
    .footer-inner { max-width:1100px; margin:0 auto; padding:16px 18px; display:flex; gap:14px; align-items:center; justify-content:space-between; color:#6b7280; font-size:.9rem; }
    .footer-links a { color:#6b7280; text-decoration:none; margin-left:12px; }
    .footer-links a:hover { text-decoration:underline; }
  </style>
</head>
<body>
  <!-- Auth guard (vendors only) -->
  <script>
    (async () => {
      try {
        const token = localStorage.getItem("boop_jwt");
        if (!token) throw new Error("No token");
        const res = await fetch("/api/me", { headers: { Authorization: `Bearer ${token}` }});
        if (!res.ok) throw new Error("Unauthorized");
        const me = await res.json();
        if (!me || me.role !== "vendor") throw new Error("Not a vendor");
        localStorage.setItem("boopUser", JSON.stringify(me));
        window.__vendorName = (me.first_name && me.last_name) ? (me.first_name + " " + me.last_name) : (me.email || "Vendor");
      } catch (err) {
        localStorage.clear();
        location.href = "../login.html";
      }
    })();
  </script>

  <!-- Top Nav (LOCKED) -->
  <nav class="vendor-nav">
    <div class="nav-container">
      <div class="nav-left">
        <img src="../assets/Boop-Logo.png" alt="BOOP Logo" />
      </div>
      <div class="nav-right">
        <a href="index.html">Home</a>
        <a href="transfer.html">Transfer</a>
        <a href="transactions.html">Transactions</a>
        <a href="#" id="logoutLink">Log Out</a>
      </div>
    </div>
  </nav>

  <!-- Hero -->
  <section class="hero">
    <div class="hero-inner">
      <h1 id="welcomeTitle">Welcome</h1>
      <p class="hero-sub">See your BOOP balance, transfer funds to your bank, and review recent transactions.</p>
    </div>
  </section>

  <!-- Quick stats -->
  <section class="stats">
    <div class="stat">
      <p class="label">Current Balance</p>
      <p class="value" id="balanceValue">—</p>
    </div>
    <div class="stat">
      <p class="label">Today’s Sales</p>
      <p class="value" id="todaysSales">—</p>
    </div>
    <div class="stat">
      <p class="label">Pending Payouts</p>
      <p class="value" id="pendingPayouts">—</p>
    </div>
  </section>

  <!-- Main tiles -->
  <section class="tiles">
    <a class="tile" href="index.html">
      <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M3 12l2-2m0 0l7-7 7 7m-9 2v6m-4 4h10m-6-10h6" stroke="#1f2937" stroke-width="2" stroke-linecap="round"/></svg>
      <span><span class="title">Overview</span><br/><span class="sub">See your balance and stats</span></span>
    </a>
    <a class="tile" href="transfer.html">
      <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M17 6H7m10 4l-4-4m4 4l-4 4M7 18h10m-10-4l4 4m-4-4l4-4" stroke="#1f2937" stroke-width="2" stroke-linecap="round"/></svg>
      <span><span class="title">Transfer to Bank</span><br/><span class="sub">Move funds from BOOP to your bank</span></span>
    </a>
    <a class="tile" href="transactions.html">
      <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M3 6h18M3 12h12M3 18h9" stroke="#1f2937" stroke-width="2" stroke-linecap="round"/></svg>
      <span><span class="title">Transactions</span><br/><span class="sub">View your recent activity</span></span>
    </a>
  </section>

  <!-- Footer -->
  <footer>
    <div class="footer-inner">
      <div>© 2025 BOOP</div>
      <div class="footer-links">
        <a href="/terms.html" target="_blank" rel="noopener">Terms</a>
        <a href="/privacy.html" target="_blank" rel="noopener">Privacy</a>
      </div>
    </div>
  </footer>

  <script>
    // Welcome line
    document.addEventListener("DOMContentLoaded", () => {
      const name = window.__vendorName || "Vendor";
      const title = document.getElementById("welcomeTitle");
      if (title) title.textContent = `Welcome, ${name}`;
    });

    // Simple stats hydration (same as before)
    (async function loadStats(){
      const token = localStorage.getItem("boop_jwt");
      const setText = (id,v) => { const el=document.getElementById(id); if (el) el.textContent = v; };
      try {
        const me = JSON.parse(localStorage.getItem("boopUser") || "{}");
        let bal = null;
        let r = await fetch("/api/wallets/me", { headers:{ Authorization:`Bearer ${token}` }}).catch(()=>null);
        if (r && r.ok) { const j = await r.json(); bal = j?.balance_cents; }
        if (bal == null && me?.id) {
          r = await fetch(`/api/wallets/user/${me.id}`, { headers:{ Authorization:`Bearer ${token}` }}).catch(()=>null);
          if (r && r.ok) { const j = await r.json(); bal = j?.balance_cents; }
        }
        if (bal != null) setText("balanceValue", "$" + (Number(bal)/100).toFixed(2));
      } catch {}
      setText("todaysSales", "—");
      setText("pendingPayouts", "—");
    })();

    // Logout
    document.getElementById("logoutLink")?.addEventListener("click", async (e) => {
      e.preventDefault();
      try { await fetch("/api/logout", { method:"POST" }); } catch {}
      localStorage.clear();
      location.href = "vendor-login.html";
    });
  </script>
</body>
</html>
